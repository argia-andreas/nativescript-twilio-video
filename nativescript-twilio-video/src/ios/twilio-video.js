"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var delegates_1 = require("./delegates");
var VideoActivity = (function () {
    function VideoActivity() {
        this._cameraCapturerDelegate = delegates_1.CameraCapturerDelegate.initWithOwner(new WeakRef(this));
        this._roomDelegate = delegates_1.RoomDelegate.initWithOwner(new WeakRef(this));
        this._participantDelegate = delegates_1.ParticipantDelegate.initWithOwner(new WeakRef(this));
    }
    VideoActivity.prototype.connect_to_room = function (roomName) {
        var _this = this;
        if (!this.accessToken)
            return;
        var connectOptions = TVIConnectOptions.optionsWithTokenBlock(this.accessToken, function (builder) {
            builder.audioTracks = [_this.localAudioTrack];
            builder.videoTracks = [_this.localVideoTrack];
            builder.roomName = roomName;
            return builder;
        });
        this.roomObj = TwilioVideo.connectWithOptionsDelegate(connectOptions, this._roomDelegate);
    };
    VideoActivity.prototype.createAudioAndVideoTracks = function () {
        this.cameraCapturer = TVICameraCapturer.alloc().init().initWithSourceDelegate(TVICameraCaptureSourceFrontCamera, this._cameraCapturerDelegate);
        this.localVideoTrack = TVILocalVideoTrack.trackWithCapturer(this.cameraCapturer);
        this.localVideoTrack.addRenderer(this.localVideoView);
        this.localVideoView.mirror = true;
        this.configure_audio(true);
    };
    VideoActivity.prototype.toggle_local_audio = function () {
        if (this.localAudioTrack) {
            this.localAudioTrack.enabled = !this.localAudioTrack.isEnabled;
        }
    };
    VideoActivity.prototype.configure_audio = function (enable) {
        if (!this.localAudioTrack) {
            this.localAudioTrack = TVILocalAudioTrack.track();
            if (!this.localAudioTrack) {
                return 'failed to get local audio';
            }
        }
    };
    VideoActivity.prototype.removeParticipantVideo = function (participant) {
        if (participant) {
            if (participant.videoTracks.count > 0) {
                participant.videoTracks[0].removeRenderer(this.remoteVideoView);
                this.remoteVideoView.removeFromSuperview();
            }
            participant = null;
        }
    };
    VideoActivity.prototype.set_listener_for_participants = function (room) {
        if (room.participants.count > 0) {
            var participant = room.participants[0];
            participant.delegate = this._participantDelegate;
        }
    };
    VideoActivity.prototype.participant_joined_room = function (participant) {
        if (!this.participant) {
            this.participant = participant;
            this.participant.delegate = this._participantDelegate;
        }
    };
    VideoActivity.prototype.add_video_track = function (videoTrack) {
        videoTrack.addRenderer(this.remoteVideoView);
    };
    VideoActivity.prototype.removeParticipant = function (participant) {
        if (participant.videoTracks.count > 0) {
            participant.videoTracks[0].removeRenderer(this.remoteVideoView);
            this.remoteVideoView.removeFromSuperview();
        }
        participant = null;
    };
    VideoActivity.prototype.set_access_token = function (token) {
        this.accessToken = token;
    };
    VideoActivity.prototype.toggle_local_video = function () {
        if (this.localVideoTrack) {
            this.localVideoTrack.enabled = !this.localVideoTrack.enabled;
        }
    };
    VideoActivity.prototype.destroy_local_video = function () {
        this.localVideoTrack.removeRenderer(this.localVideoView);
    };
    Object.defineProperty(VideoActivity.prototype, "events", {
        get: function () {
            return delegates_1.DelegateEvents._events;
        },
        enumerable: true,
        configurable: true
    });
    return VideoActivity;
}());
exports.VideoActivity = VideoActivity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHdpbGlvLXZpZGVvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidHdpbGlvLXZpZGVvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EseUNBQXdHO0FBV3hHO0lBaUJJO1FBRUksSUFBSSxDQUFDLHVCQUF1QixHQUFHLGtDQUFzQixDQUFDLGFBQWEsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBRXZGLElBQUksQ0FBQyxhQUFhLEdBQUcsd0JBQVksQ0FBQyxhQUFhLENBQUMsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUVuRSxJQUFJLENBQUMsb0JBQW9CLEdBQUcsK0JBQW1CLENBQUMsYUFBYSxDQUFDLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFFckYsQ0FBQztJQUVNLHVDQUFlLEdBQXRCLFVBQXVCLFFBQWdCO1FBQXZDLGlCQW9CQztRQWxCRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7WUFBQyxNQUFNLENBQUM7UUFFOUIsSUFBSSxjQUFjLEdBQUcsaUJBQWlCLENBQUMscUJBQXFCLENBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFDLE9BQU87WUFJcEYsT0FBTyxDQUFDLFdBQVcsR0FBRyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQTtZQUU1QyxPQUFPLENBQUMsV0FBVyxHQUFHLENBQUMsS0FBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO1lBRTVDLE9BQU8sQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1lBRTVCLE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFFbkIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRTlGLENBQUM7SUFFTSxpREFBeUIsR0FBaEM7UUFFSSxJQUFJLENBQUMsY0FBYyxH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QyxDQUFDO1FBRUQsV0FBVyxHQUFHLElBQUksQ0FBQztJQUV2QixDQUFDO0lBRU0sd0NBQWdCLEdBQXZCLFVBQXdCLEtBQWE7UUFFakMsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7SUFFN0IsQ0FBQztJQUdNLDBDQUFrQixHQUF6QjtRQUVJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1lBRXZCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUE7UUFFaEUsQ0FBQztJQUVMLENBQUM7SUFHTSwyQ0FBbUIsR0FBMUI7UUFFSSxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBRSxJQUFJLENBQUMsY0FBYyxDQUFFLENBQUM7SUFFL0QsQ0FBQztJQUdELHNCQUFJLGlDQUFNO2FBQVY7WUFFSSxNQUFNLENBQUMsMEJBQWMsQ0FBQyxPQUFPLENBQUM7UUFFbEMsQ0FBQzs7O09BQUE7SUFHTCxvQkFBQztBQUFELENBQUMsQUFuTEQsSUFtTEM7QUFuTFksc0NBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IFJlbW90ZVZpZGVvIH0gZnJvbSBcIi4vcmVtb3RlVmlkZW9cIjtcbmltcG9ydCB7IExvY2FsVmlkZW8gfSBmcm9tIFwiLi9sb2NhbFZpZGVvXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tT2JqZWN0IH0gZnJvbSAndG5zLWNvcmUtbW9kdWxlcy9kYXRhL29ic2VydmFibGUnO1xuaW1wb3J0IHsgVmlkZW9BY3Rpdml0eUJhc2UgfSBmcm9tIFwiLi4vdHdpbGlvLWNvbW1vblwiO1xuaW1wb3J0IHsgQ2FtZXJhQ2FwdHVyZXJEZWxlZ2F0ZSwgUm9vbURlbGVnYXRlLCBQYXJ0aWNpcGFudERlbGVnYXRlLCBEZWxlZ2F0ZUV2ZW50cyB9IGZyb20gXCIuL2RlbGVnYXRlc1wiO1xuXG5kZWNsYXJlIHZhciBUVklDb25uZWN0T3B0aW9ucyxcbiAgICAgICAgICAgIFRWSVZpZGVvQ2xpZW50LFxuICAgICAgICAgICAgVFZJQ2FtZXJhQ2FwdHVyZXIsXG4gICAgICAgICAgICBUVklMb2NhbFZpZGVvVHJhY2ssXG4gICAgICAgICAgICBUd2lsaW9WaWRlbyxcbiAgICAgICAgICAgIFRWSUxvY2FsQXVkaW9UcmFjayxcbiAgICAgICAgICAgIFRWSUNhbWVyYUNhcHR1cmVTb3VyY2VGcm9udENhbWVyYTtcblxuXG5leHBvcnQgY2xhc3MgVmlkZW9BY3Rpdml0eSBpbXBsZW1lbnRzIFZpZGVvQWN0aXZpdHlCYXNlIHtcblxuICAgIHB1YmxpYyBsb2NhbFZpZGVvVmlldzogYW55O1xuICAgIHB1YmxpYyByZW1vdGVWaWRlb1ZpZXc6IGFueTtcbiAgICBwdWJsaWMgbG9jYWxWaWRlb1RyYWNrOiBhbnk7XG4gICAgcHVibGljIGxvY2FsQXVkaW9UcmFjazogYW55O1xuICAgIHB1YmxpYyBjYW1lcmFDYXB0dXJlcjogYW55O1xuICAgIHB1YmxpYyBfY2FtZXJhQ2FwdHVyZXJEZWxlZ2F0ZTogYW55O1xuICAgIHB1YmxpYyBhY2Nlc3NUb2tlbjogc3RyaW5nO1xuICAgIHB1YmxpYyByb29tT2JqOiBhbnk7XG4gICAgcHVibGljIHByZXZpb3VzTWljcm9waG9uZU11dGU6IGJvb2xlYW47XG4gICAgcHVibGljIGxvY2FsUGFydGljaXBhbnQ6IGFueTtcbiAgICBwdWJsaWMgcmVtb3RlUGFydGljaXBhbnQ6IGFueTtcbiAgICBwcml2YXRlIF9yb29tTGlzdGVuZXI6IGFueTtcbiAgICBwcml2YXRlIF9wYXJ0aWNpcGFudERlbGVnYXRlOiBhbnk7XG4gICAgcHJpdmF0ZSBfcm9vbURlbGVnYXRlOiBhbnk7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHsgXG4gICAgICAgIFxuICAgICAgICB0aGlzLl9jYW1lcmFDYXB0dXJlckRlbGVnYXRlID0gQ2FtZXJhQ2FwdHVyZXJEZWxlZ2F0ZS5pbml0V2l0aE93bmVyKG5ldyBXZWFrUmVmKHRoaXMpKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuX3Jvb21EZWxlZ2F0ZSA9IFJvb21EZWxlZ2F0ZS5pbml0V2l0aE93bmVyKG5ldyBXZWFrUmVmKHRoaXMpKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuX3BhcnRpY2lwYW50RGVsZWdhdGUgPSBQYXJ0aWNpcGFudERlbGVnYXRlLmluaXRXaXRoT3duZXIobmV3IFdlYWtSZWYodGhpcykpO1xuXG4gICAgfVxuXG4gICAgcHVibGljIGNvbm5lY3RfdG9fcm9vbShyb29tTmFtZTogc3RyaW5nKSB7XG5cbiAgICAgICAgaWYgKCF0aGlzLmFjY2Vzc1Rva2VuKSByZXR1cm47IC8vIGdldFRva2VuKCk7XG5cbiAgICAgICAgdmFyIGNvbm5lY3RPcHRpb25zID0gVFZJQ29ubmVjdE9wdGlvbnMub3B0aW9uc1dpdGhUb2tlbkJsb2NrKCB0aGlzLmFjY2Vzc1Rva2VuLCAoYnVpbGRlcikgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBidWlsZGVyLmxvY2FsTWVkaWEgPSBudWxsO1xuXG4gICAgICAgICAgICBidWlsZGVyLmF1ZGlvVHJhY2tzID0gW3RoaXMubG9jYWxBdWRpb1RyYWNrXVxuXG4gICAgICAgICAgICBidWlsZGVyLnZpZGVvVHJhY2tzID0gW3RoaXMubG9jYWxWaWRlb1RyYWNrXVxuXG4gICAgICAgICAgICBidWlsZGVyLnJvb21OYW1lID0gcm9vbU5hbWU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBidWlsZGVyO1xuXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5yb29tT2JqID0gVHdpbGlvVmlkZW8uY29ubmVjdFdpdGhPcHRpb25zRGVsZWdhdGUoY29ubmVjdE9wdGlvbnMsIHRoaXMuX3Jvb21EZWxlZ2F0ZSk7ICAgICAgXG4gICAgICBcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlQXVkaW9BbmRWaWRlb1RyYWNrcygpIHtcblxuICAgICAgICB0aGlzLmNhbWVyYUNhcHR1cmVyID0gVFZJQ2FtZXJhQ2FwdHVyZXIuYWxsb2MoKS5pbml0KCkuaW5pdFdpdGhTb3VyY2VEZWxlZ2F0ZShUVklDYW1lcmFDYXB0dXJlU291cmNlRnJvbnRDYW1lcmEsIHRoaXMuX2NhbWVyYUNhcHR1cmVyRGVsZWdhdGUpO1xuXG4gICAgICAgIHRoaXMubG9jYWxWaWRlb1RyYWNrID0gVFZJTG9jYWxWaWRlb1RyYWNrLnRyYWNrV2l0aENhcHR1cmVyKHRoaXMuY2FtZXJhQ2FwdHVyZXIpO1xuXG4gICAgICAgIHRoaXMubG9jYWxWaWRlb1RyYWNrLmFkZFJlbmRlcmVyKCB0aGlzLmxvY2FsVmlkZW9WaWV3ICk7XG5cbiAgICAgICAgdGhpcy5sb2NhbFZpZGVvVmlldy5taXJyb3IgPSB0cnVlOyAgIFxuXG4gICAgICAgIHRoaXMuY29uZmlndXJlX2F1ZGlvKHRydWUpO1xuXG5cbiAgICB9XG5cbiAgICBwdWJsaWMgdG9nZ2xlX2xvY2FsX2F1ZGlvKCkge1xuICAgICAgICBcbiAgICAgICAgaWYgKHRoaXMubG9jYWxBdWRpb1RyYWNrKSB7XG5cbiAgICAgICAgICAgIHRoaXMubG9jYWxBdWRpb1RyYWNrLmVuYWJsZWQgPSAhdGhpcy5sb2NhbEF1ZGlvVHJhY2suaXNFbmFibGVkO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBjb25maWd1cmVfYXVkaW8oZW5hYmxlOiBib29sZWFuKTogYW55IHtcblxuICAgICAgICAvLyBXZSB3aWxsIHNoYXJlIGxvY2FsIGF1ZGlvIGFuZCB2aWRlbyB3aGVuIHdlIGNvbm5lY3QgdG8gcm9vbS5cblxuICAgICAgICAvLyBDcmVhdGUgYW4gYXVkaW8gdHJhY2suXG4gICAgICAgIGlmICghdGhpcy5sb2NhbEF1ZGlvVHJhY2spIHtcblxuICAgICAgICAgICAgdGhpcy5sb2NhbEF1ZGlvVHJhY2sgPSBUVklMb2NhbEF1ZGlvVHJhY2sudHJhY2soKTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmxvY2FsQXVkaW9UcmFjaykge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICdmYWlsZWQgdG8gZ2V0IGxvY2FsIGF1ZGlvJztcblxuICAgICAgICAgICAgfSAgICAgICAgIFxuXG4gICAgICAgIH0gXG5cbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlUGFydGljaXBhbnRWaWRlbyhwYXJ0aWNpcGFudCkge1xuICAgICAgICBpZiAocGFydGljaXBhbnQpIHtcbiAgICAgICAgICAgIGlmIChwYXJ0aWNpcGFudC52aWRlb1RyYWNrcy5jb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICBwYXJ0aWNpcGFudC52aWRlb1RyYWNrc1swXS5yZW1vdmVSZW5kZXJlcih0aGlzLnJlbW90ZVZpZGVvVmlldyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdGVWaWRlb1ZpZXcucmVtb3ZlRnJvbVN1cGVydmlldygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFydGljaXBhbnQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHNldF9saXN0ZW5lcl9mb3JfcGFydGljaXBhbnRzKHJvb20pIHsgLy8gcnVucyBmcm9tIG9uQ29ubmVjdGVkL2RpZENvbm5lY3RUb1Jvb21cblxuICAgICAgICBpZiAocm9vbS5wYXJ0aWNpcGFudHMuY291bnQgPiAwKSB7XG5cbiAgICAgICAgICAgIGxldCBwYXJ0aWNpcGFudCA9IHJvb20ucGFydGljaXBhbnRzWzBdO1xuXG4gICAgICAgICAgICBwYXJ0aWNpcGFudC5kZWxlZ2F0ZSA9IHRoaXMuX3BhcnRpY2lwYW50RGVsZWdhdGU7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHVibGljIHBhcnRpY2lwYW50X2pvaW5lZF9yb29tKHBhcnRpY2lwYW50KSB7XG5cbiAgICAgICAgaWYgKCF0aGlzLnBhcnRpY2lwYW50KSB7XG4gICAgICAgIFxuICAgICAgICAgICAgdGhpcy5wYXJ0aWNpcGFudCA9IHBhcnRpY2lwYW50O1xuXG4gICAgICAgICAgICB0aGlzLnBhcnRpY2lwYW50LmRlbGVnYXRlID0gdGhpcy5fcGFydGljaXBhbnREZWxlZ2F0ZTtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkX3ZpZGVvX3RyYWNrKHZpZGVvVHJhY2spIHtcblxuICAgICAgICB2aWRlb1RyYWNrLmFkZFJlbmRlcmVyKHRoaXMucmVtb3RlVmlkZW9WaWV3KTtcblxuICAgIH1cblxuICAgIHB1YmxpYyByZW1vdmVQYXJ0aWNpcGFudChwYXJ0aWNpcGFudCkge1xuXG4gICAgICAgIGlmIChwYXJ0aWNpcGFudC52aWRlb1RyYWNrcy5jb3VudCA+IDApIHtcblxuICAgICAgICAgICAgcGFydGljaXBhbnQudmlkZW9UcmFja3NbMF0ucmVtb3ZlUmVuZGVyZXIodGhpcy5yZW1vdGVWaWRlb1ZpZXcpO1xuXG4gICAgICAgICAgICB0aGlzLnJlbW90ZVZpZGVvVmlldy5yZW1vdmVGcm9tU3VwZXJ2aWV3KCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHBhcnRpY2lwYW50ID0gbnVsbDtcblxuICAgIH1cblxuICAgIHB1YmxpYyBzZXRfYWNjZXNzX3Rva2VuKHRva2VuOiBzdHJpbmcpIHtcblxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gdG9rZW47XG5cbiAgICB9XG5cblxuICAgIHB1YmxpYyB0b2dnbGVfbG9jYWxfdmlkZW8oKSB7XG5cbiAgICAgICAgaWYgKHRoaXMubG9jYWxWaWRlb1RyYWNrKSB7XG5cbiAgICAgICAgICAgIHRoaXMubG9jYWxWaWRlb1RyYWNrLmVuYWJsZWQgPSAhdGhpcy5sb2NhbFZpZGVvVHJhY2suZW5hYmxlZFxuXG4gICAgICAgIH1cblxuICAgIH1cblxuXG4gICAgcHVibGljIGRlc3Ryb3lfbG9jYWxfdmlkZW8oKSB7XG5cbiAgICAgICAgdGhpcy5sb2NhbFZpZGVvVHJhY2sucmVtb3ZlUmVuZGVyZXIoIHRoaXMubG9jYWxWaWRlb1ZpZXcgKTtcblxuICAgIH1cblxuXG4gICAgZ2V0IGV2ZW50cygpOiBPYnNlcnZhYmxlIHtcblxuICAgICAgICByZXR1cm4gRGVsZWdhdGVFdmVudHMuX2V2ZW50cztcblxuICAgIH1cblxuXG59XG5cbiJdfQ==