"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var delegates_1 = require("./delegates");
var VideoActivity = (function () {
    function VideoActivity() {
        this._cameraCapturerDelegate = delegates_1.CameraCapturerDelegate.initWithOwner(new WeakRef(this));
        this._roomDelegate = delegates_1.RoomDelegate.initWithOwner(new WeakRef(this));
        this._participantDelegate = delegates_1.ParticipantDelegate.initWithOwner(new WeakRef(this));
    }
    VideoActivity.prototype.connect_to_room = function (roomName) {
        var _this = this;
        if (!this.accessToken)
            return;
        var connectOptions = TVIConnectOptions.optionsWithTokenBlock(this.accessToken, function (builder) {
            builder.audioTracks = [_this.localAudioTrack];
            builder.videoTracks = [_this.localVideoTrack];
            builder.roomName = roomName;
            return builder;
        });
        this.roomObj = TwilioVideo.connectWithOptionsDelegate(connectOptions, this._roomDelegate);
    };
    VideoActivity.prototype.createAudioAndVideoTracks = function () {
        this.cameraCapturer = TVICameraCapturer.alloc().init().initWithSourceDelegate(TVICameraCaptureSourceFrontCamera, this._cameraCapturerDelegate);
        this.localVideoTrack = TVILocalVideoTrack.trackWithCapturer(this.cameraCapturer);
        this.localVideoTrack.addRenderer(this.localVideoView);
        this.localVideoView.mirror = true;
        this.configure_audio(true);
    };
    VideoActivity.prototype.configure_audio = function (enable) {
        if (!this.localAudioTrack) {
            this.localAudioTrack = TVILocalAudioTrack.track();
            if (!this.localAudioTrack) {
                return 'failed to get local audio';
            }
        }
    };
    VideoActivity.prototype.removeParticipantVideo = function (participant) {
        if (participant) {
            if (participant.videoTracks.count > 0) {
                participant.videoTracks[0].removeRenderer(this.remoteVideoView);
                this.remoteVideoView.removeFromSuperview();
            }
            participant = null;
            this.participant = null;
        }
    };
    VideoActivity.prototype.set_listener_for_participants = function (room) {
        if (room.participants.count > 0) {
            var participant = room.participants[0];
            participant.delegate = this._participantDelegate;
        }
    };
    VideoActivity.prototype.participant_joined_room = function (participant) {
        if (!this.participant) {
            this.participant = participant;
            this.participant.delegate = this._participantDelegate;
        }
    };
    VideoActivity.prototype.add_video_track = function (videoTrack) {
        videoTrack.addRenderer(this.remoteVideoView);
    };
    VideoActivity.prototype.removeParticipant = function (participant) {
        if (participant.videoTracks.count > 0) {
            participant.videoTracks[0].removeRenderer(this.remoteVideoView);
        }
        participant = null;
        this.participant = null;
    };
    VideoActivity.prototype.set_access_token = function (token) {
        this.accessToken = token;
    };
    VideoActivity.prototype.toggle_local_video = function () {
        if (this.localVideoTrack) {
            this.localVideoTrack.enabled = !this.localVideoTrack.enabled;
        }
    };
    VideoActivity.prototype.toggle_local_audio = function () {
        if (this.localAudioTrack) {
            this.localAudioTrack.enabled = !this.localAudioTrack.enabled;
        }
    };
    VideoActivity.prototype.destroy_local_video = function () {
        this.localVideoTrack.removeRenderer(this.localVideoView);
    };
    Object.defineProperty(VideoActivity.prototype, "events", {
        get: function () {
            return delegates_1.DelegateEvents._events;
        },
        enumerable: true,
        configurable: true
    });
    return VideoActivity;
}());
exports.VideoActivity = VideoActivity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHdpbGlvLXZpZGVvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidHdpbGlvLXZpZGVvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EseUNBQXdHO0FBV3hHO0lBa0JJO1FBRUksSUFBSSxDQUFDLHVCQUF1QixHQUFHLGtDQUFzQixDQUFDLGFBQWEsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBRXZGLElBQUksQ0FBQyxhQUFhLEdBQUcsd0JBQVksQ0FBQyxhQUFhLENBQUMsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUVuRSxJQUFJLENBQUMsb0JBQW9CLEdBQUcsK0JBQW1CLENBQUMsYUFBYSxDQUFDLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFFckYsQ0FBQztJQUVNLHVDQUFlLEdBQXRCLFVBQXVCLFFBQWdCO1FBQXZDLGlCQW9CQztRQWxCRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7WUFBQyxNQUFNLENBQUM7UUFFOUIsSUFBSSxjQUFjLEdBQUcsaUJBQWlCLENBQUMscUJBQXFCLENBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFDLE9BQU87WUFJcEYsT0FBTyxDQUFDLFdBQVcsR0FBRyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQTtZQUU1QyxPQUFPLENBQUMsV0FBVyxHQUFHLENBQUMsS0FBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO1lBRTVDLE9BQU8sQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1lBRTVCLE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFFbkIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRTlGLENBQUM7SUFFTSxpREFBeUIsR0FBaEM7UUFFSSxJQUFJLENBQUMsY0FBYyxH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R0FBekI7UUFFSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztZQUV2QixJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDO1FBRWpFLENBQUM7SUFFTCxDQUFDO0lBRU0sMENBQWtCLEdBQXpCO1FBRUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7WUFFdkIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQztRQUVqRSxDQUFDO0lBRUwsQ0FBQztJQUdNLDJDQUFtQixHQUExQjtRQUVJLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFFLElBQUksQ0FBQyxjQUFjLENBQUUsQ0FBQztJQUUvRCxDQUFDO0lBR0Qsc0JBQUksaUNBQU07YUFBVjtZQUVJLE1BQU0sQ0FBQywwQkFBYyxDQUFDLE9BQU8sQ0FBQztRQUVsQyxDQUFDOzs7T0FBQTtJQUdMLG9CQUFDO0FBQUQsQ0FBQyxBQTFMRCxJQTBMQztBQTFMWSxzQ0FBYSIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgUmVtb3RlVmlkZW8gfSBmcm9tIFwiLi9yZW1vdGVWaWRlb1wiO1xuaW1wb3J0IHsgTG9jYWxWaWRlbyB9IGZyb20gXCIuL2xvY2FsVmlkZW9cIjtcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb21PYmplY3QgfSBmcm9tICd0bnMtY29yZS1tb2R1bGVzL2RhdGEvb2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBWaWRlb0FjdGl2aXR5QmFzZSB9IGZyb20gXCIuLi90d2lsaW8tY29tbW9uXCI7XG5pbXBvcnQgeyBDYW1lcmFDYXB0dXJlckRlbGVnYXRlLCBSb29tRGVsZWdhdGUsIFBhcnRpY2lwYW50RGVsZWdhdGUsIERlbGVnYXRlRXZlbnRzIH0gZnJvbSBcIi4vZGVsZWdhdGVzXCI7XG5cbmRlY2xhcmUgdmFyIFRWSUNvbm5lY3RPcHRpb25zLFxuICAgICAgICAgICAgVFZJVmlkZW9DbGllbnQsXG4gICAgICAgICAgICBUVklDYW1lcmFDYXB0dXJlcixcbiAgICAgICAgICAgIFRWSUxvY2FsVmlkZW9UcmFjayxcbiAgICAgICAgICAgIFR3aWxpb1ZpZGVvLFxuICAgICAgICAgICAgVFZJTG9jYWxBdWRpb1RyYWNrLFxuICAgICAgICAgICAgVFZJQ2FtZXJhQ2FwdHVyZVNvdXJjZUZyb250Q2FtZXJhO1xuXG5cbmV4cG9ydCBjbGFzcyBWaWRlb0FjdGl2aXR5IGltcGxlbWVudHMgVmlkZW9BY3Rpdml0eUJhc2Uge1xuXG4gICAgcHVibGljIGxvY2FsVmlkZW9WaWV3OiBhbnk7XG4gICAgcHVibGljIHJlbW90ZVZpZGVvVmlldzogYW55O1xuICAgIHB1YmxpYyBsb2NhbFZpZGVvVHJhY2s6IGFueTtcbiAgICBwdWJsaWMgbG9jYWxBdWRpb1RyYWNrOiBhbnk7XG4gICAgcHVibGljIGNhbWVyYUNhcHR1cmVyOiBhbnk7XG4gICAgcHVibGljIF9jYW1lcmFDYXB0dXJlckRlbGVnYXRlOiBhbnk7XG4gICAgcHVibGljIGFjY2Vzc1Rva2VuOiBzdHJpbmc7XG4gICAgcHVibGljIHJvb21PYmo6IGFueTtcbiAgICBwdWJsaWMgcHJldmlvdXNNaWNyb3Bob25lTXV0ZTogYm9vbGVhbjtcbiAgICBwdWJsaWMgbG9jYWxQYXJ0aWNpcGFudDogYW55O1xuICAgIHB1YmxpYyByZW1vdGVQYXJ0aWNpcGFudDogYW55O1xuICAgIHByaXZhdGUgX3Jvb21MaXN0ZW5lcjogYW55O1xuICAgIHByaXZhdGUgX3BhcnRpY2lwYW50RGVsZWdhdGU6IGFueTtcbiAgICBwcml2YXRlIF9yb29tRGVsZWdhdGU6IGFueTtcbiAgICBwdWJsaWMgcGFydGljaXBhbnQ6IGFueTtcblxuICAgIGNvbnN0cnVjdG9yKCkgeyBcbiAgICAgICAgXG4gICAgICAgIHRoaXMuX2NhbWVyYUNhcHR1cmVyRGVsZWdhdGUgPSBDYW1lcmFDYXB0dXJlckRlbGVnYXRlLmluaXRXaXRoT3duZXIobmV3IFdlYWtSZWYodGhpcykpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5fcm9vbURlbGVnYXRlID0gUm9vbURlbGVnYXRlLmluaXRXaXRoT3duZXIobmV3IFdlYWtSZWYodGhpcykpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5fcGFydGljaXBhbnREZWxlZ2F0ZSA9IFBhcnRpY2lwYW50RGVsZWdhdGUuaW5pdFdpdGhPd25lcihuZXcgV2Vha1JlZih0aGlzKSk7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgY29ubmVjdF90b19yb29tKHJvb21OYW1lOiBzdHJpbmcpIHtcblxuICAgICAgICBpZiAoIXRoaXMuYWNjZXNzVG9rZW4pIHJldHVybjsgLy8gZ2V0VG9rZW4oKTtcblxuICAgICAgICB2YXIgY29ubmVjdE9wdGlvbnMgPSBUVklDb25uZWN0T3B0aW9ucy5vcHRpb25zV2l0aFRva2VuQmxvY2soIHRoaXMuYWNjZXNzVG9rZW4sIChidWlsZGVyKSA9PiB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGJ1aWxkZXIubG9jYWxNZWRpYSA9IG51bGw7XG5cbiAgICAgICAgICAgIGJ1aWxkZXIuYXVkaW9UcmFja3MgPSBbdGhpcy5sb2NhbEF1ZGlvVHJhY2tdXG5cbiAgICAgICAgICAgIGJ1aWxkZXIudmlkZW9UcmFja3MgPSBbdGhpcy5sb2NhbFZpZGVvVHJhY2tdXG5cbiAgICAgICAgICAgIGJ1aWxkZXIucm9vbU5hbWUgPSByb29tTmFtZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7XG5cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJvb21PYmogPSBUd2lsaW9WaWRlby5jb25uZWN0V2l0aE9wdGlvbnNEZWxlZ2F0ZShjb25uZWN0T3B0aW9ucywgdGhpcy5fcm9vbURlbGVnYXRlKTsgICAgICBcbiAgICAgIFxuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVBdWRpb0FuZFZpZGVvVHJhY2tzKCkge1xuXG4gICAgICAgIHRoaXMuY2FtZXJhQ2FwdHVyZXIgPSBUVklDYW1lcmFDYXB0dXJlci5hbGxvYygpLmluaXQoKS5pbml0V2l0aFNvdXJjZURlbGVnYXRlKFRWSUNhbWVyYUNhcHR1cmVTb3VyY2VGcm9udENhbWVyYSwgdGhpcy5fY2FtZXJhQ2FwdHVyZXJEZWxlZ2F0ZSk7XG5cbiAgICAgICAgdGhpcy5sb2NhbFZpZGVvVHJhY2sgPSBUVklMb2NhbFZpZGVvVHJhY2sudHJhY2tXaXRoQ2FwdHVyZXIodGhpcy5jYW1lcmFDYXB0dXJlcik7XG5cbiAgICAgICAgdGhpcy5sb2NhbFZpZGVvVHJhY2suYWRkUmVuZGVyZXIoIHRoaXMubG9jYWxWaWRlb1ZpZXcgKTtcblxuICAgICAgICB0aGlzLmxvY2FsVmlkZW9WaWV3Lm1pcnJvciA9IHRydWU7ICAgXG5cbiAgICAgICAgdGhpcy5jb25maWd1cmVfYXVkaW8odHJ1ZSk7XG5cblxuICAgIH1cblxuXG4gICAgcHVibGljIGNvbmZpZ3VyZV9hdWRpbyhlbmFibGU6IGJvb2xlYW4pOiBhbnkge1xuXG4gICAgICAgIC8vIFdlIHdpbGwgc2hhcmUgbG9jYWwgYXVkaW8gYW5kIHZpZGVvIHdoZW4gd2UgY29ubmVjdCB0byByb29tLlxuXG4gICAgICAgIC8vIENyZWF0ZSBhbiBhdWRpbyB0cmFjay5cbiAgICAgICAgaWYgKCF0aGlzLmxvY2FsQXVkaW9UcmFjaykge1xuXG4gICAgICAgICAgICB0aGlzLmxvY2FsQXVkaW9UcmFjayA9IFRWSUxvY2FsQXVkaW9UcmFjay50cmFjaygpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMubG9jYWxBdWRpb1RyYWNrKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJ2ZhaWxlZCB0byBnZXQgbG9jYWwgYXVkaW8nO1xuXG4gICAgICAgICAgICB9ICAgICAgICAgXG5cbiAgICAgICAgfSBcblxuICAgIH1cblxuICAgIHB1YmxpYyByZW1vdmVQYXJ0aWNpcGFudFZpZGVvKHBhcnRpY2lwYW50KSB7XG4gICAgICAgIGlmIChwYXJ0aWNpcGFudCkge1xuICAgICAgICAgICAgaWYgKHBhcnRpY2lwYW50LnZpZGVvVHJhY2tzLmNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50LnZpZGVvVHJhY2tzWzBdLnJlbW92ZVJlbmRlcmVyKHRoaXMucmVtb3RlVmlkZW9WaWV3KTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZVZpZGVvVmlldy5yZW1vdmVGcm9tU3VwZXJ2aWV3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhcnRpY2lwYW50ID0gbnVsbDtcblxuICAgICAgICAgICAgdGhpcy5wYXJ0aWNpcGFudCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0X2xpc3RlbmVyX2Zvcl9wYXJ0aWNpcGFudHMocm9vbSkgeyAvLyBydW5zIGZyb20gb25Db25uZWN0ZWQvZGlkQ29ubmVjdFRvUm9vbVxuXG4gICAgICAgIGlmIChyb29tLnBhcnRpY2lwYW50cy5jb3VudCA+IDApIHtcblxuICAgICAgICAgICAgbGV0IHBhcnRpY2lwYW50ID0gcm9vbS5wYXJ0aWNpcGFudHNbMF07XG5cbiAgICAgICAgICAgIHBhcnRpY2lwYW50LmRlbGVnYXRlID0gdGhpcy5fcGFydGljaXBhbnREZWxlZ2F0ZTtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgcGFydGljaXBhbnRfam9pbmVkX3Jvb20ocGFydGljaXBhbnQpIHtcblxuICAgICAgICBpZiAoIXRoaXMucGFydGljaXBhbnQpIHtcbiAgICAgICAgXG4gICAgICAgICAgICB0aGlzLnBhcnRpY2lwYW50ID0gcGFydGljaXBhbnQ7XG5cbiAgICAgICAgICAgIHRoaXMucGFydGljaXBhbnQuZGVsZWdhdGUgPSB0aGlzLl9wYXJ0aWNpcGFudERlbGVnYXRlO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBhZGRfdmlkZW9fdHJhY2sodmlkZW9UcmFjaykge1xuXG4gICAgICAgIHZpZGVvVHJhY2suYWRkUmVuZGVyZXIodGhpcy5yZW1vdGVWaWRlb1ZpZXcpO1xuXG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZVBhcnRpY2lwYW50KHBhcnRpY2lwYW50KSB7XG5cbiAgICAgICAgaWYgKHBhcnRpY2lwYW50LnZpZGVvVHJhY2tzLmNvdW50ID4gMCkge1xuXG4gICAgICAgICAgICBwYXJ0aWNpcGFudC52aWRlb1RyYWNrc1swXS5yZW1vdmVSZW5kZXJlcih0aGlzLnJlbW90ZVZpZGVvVmlldyk7XG5cbiAgICAgICAgICAgIC8vIHRoaXMucmVtb3RlVmlkZW9WaWV3LnJlbW92ZUZyb21TdXBlcnZpZXcoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgcGFydGljaXBhbnQgPSBudWxsO1xuXG4gICAgICAgIHRoaXMucGFydGljaXBhbnQgPSBudWxsO1xuXG4gICAgfVxuXG4gICAgcHVibGljIHNldF9hY2Nlc3NfdG9rZW4odG9rZW46IHN0cmluZykge1xuXG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSB0b2tlbjtcblxuICAgIH1cblxuXG4gICAgcHVibGljIHRvZ2dsZV9sb2NhbF92aWRlbygpIHtcblxuICAgICAgICBpZiAodGhpcy5sb2NhbFZpZGVvVHJhY2spIHtcblxuICAgICAgICAgICAgdGhpcy5sb2NhbFZpZGVvVHJhY2suZW5hYmxlZCA9ICF0aGlzLmxvY2FsVmlkZW9UcmFjay5lbmFibGVkO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyB0b2dnbGVfbG9jYWxfYXVkaW8oKSB7XG5cbiAgICAgICAgaWYgKHRoaXMubG9jYWxBdWRpb1RyYWNrKSB7XG5cbiAgICAgICAgICAgIHRoaXMubG9jYWxBdWRpb1RyYWNrLmVuYWJsZWQgPSAhdGhpcy5sb2NhbEF1ZGlvVHJhY2suZW5hYmxlZDtcblxuICAgICAgICB9XG5cbiAgICB9XG5cblxuICAgIHB1YmxpYyBkZXN0cm95X2xvY2FsX3ZpZGVvKCkge1xuXG4gICAgICAgIHRoaXMubG9jYWxWaWRlb1RyYWNrLnJlbW92ZVJlbmRlcmVyKCB0aGlzLmxvY2FsVmlkZW9WaWV3ICk7XG5cbiAgICB9XG5cblxuICAgIGdldCBldmVudHMoKTogT2JzZXJ2YWJsZSB7XG5cbiAgICAgICAgcmV0dXJuIERlbGVnYXRlRXZlbnRzLl9ldmVudHM7XG5cbiAgICB9XG5cblxufVxuXG4iXX0=