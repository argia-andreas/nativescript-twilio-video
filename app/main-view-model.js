"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var http = require("http");
var nativescript_twilio_video_1 = require("nativescript-twilio-video");
var timer = require("timer");
var permissions = require('nativescript-permissions');
var RoomDelegate = (function (_super) {
    __extends(RoomDelegate, _super);
    function RoomDelegate() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RoomDelegate.new = function () {
        return _super.new.call(this);
    };
    RoomDelegate.prototype.didConnectToRoom = function (room) {
        console.log('connected to a room');
        console.log(room);
    };
    RoomDelegate.prototype.didFailToConnectWithError = function (room, error) {
        console.log('didFailToConnectWithError');
        console.log(room);
    };
    RoomDelegate.prototype.didDisconnectWithError = function (room, error) {
        console.log('didDisconnectWithError');
        console.log(error);
        console.log(room);
    };
    ;
    RoomDelegate.prototype.participantDidConnect = function (room, participant) {
        console.log('participantDidConnect');
        console.log(room);
    };
    RoomDelegate.prototype.participantDidDisconnect = function (room, participant) {
        console.log('participantDidDisconnect');
        console.log(room);
    };
    RoomDelegate.prototype.roomDidStartRecording = function (room) {
        console.log('roomDidStartRecording');
    };
    RoomDelegate.prototype.roomDidStopRecording = function (room) {
        console.log('roomDidStopRecording');
    };
    return RoomDelegate;
}(NSObject));
RoomDelegate.ObjCProtocols = [TVIRoomDelegate];
var HelloWorldModel = (function (_super) {
    __extends(HelloWorldModel, _super);
    function HelloWorldModel(page) {
        var _this = _super.call(this) || this;
        _this.page = page;
        _this.token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImN0eSI6InR3aWxpby1mcGE7dj0xIn0.eyJqdGkiOiJTSzNjMmE5OTI1Yjg4NTUwODg1ZDhjZDJmNzMwYWNlMTZmLTE0OTc4MzE2ODkiLCJpc3MiOiJTSzNjMmE5OTI1Yjg4NTUwODg1ZDhjZDJmNzMwYWNlMTZmIiwic3ViIjoiQUM5NjFhZjMzYmUyZDI2OWIzZTM2NThiNjJlNWU1ZDU1OCIsImV4cCI6MTQ5NzgzNTI4OSwiZ3JhbnRzIjp7ImlkZW50aXR5IjoidyIsInZpZGVvIjp7InJvb20iOiJlIn19fQ.0PjYE2Dt3-3VlRi-EErMsmG44ACr313j4603O8X5AjU';
        _this.countdown = 60;
        var delegate = RoomDelegate.new();
        var connectOptions = TVIConnectOptions.optionsWithBlock(function (builder) {
            builder.name = 'crazy';
            return builder;
        });
        var videoClient = TVIVideoClient.clientWithToken(_this.token);
        _this.room = videoClient.connectWithOptionsDelegate(connectOptions, delegate);
        console.dir(_this.room);
        var self = _this;
        _this.videoActivity = new nativescript_twilio_video_1.VideoActivity();
        return _this;
    }
    HelloWorldModel.prototype.getPermissions = function () {
        permissions.requestPermissions([
            android.Manifest.permission.RECORD_AUDIO,
            android.Manifest.permission.CAMERA
        ], "I need these permissions because I'm cool")
            .then(function (response) {
        })
            .catch(function (e) {
            console.dir(e);
            console.log("Uh oh, no permissions - plan B time!");
        });
    };
    HelloWorldModel.prototype.disconnect = function () {
        console.log('clicked');
        console.log(this.room);
        this.room.disconnect();
    };
    HelloWorldModel.prototype.add_time = function () {
        console.dir(this.room);
    };
    HelloWorldModel.prototype.show_local_video = function () {
    };
    HelloWorldModel.prototype.set_access_token = function (token, name) {
    };
    HelloWorldModel.prototype.connect_to_room = function (room) {
        console.dir(this.room);
    };
    return HelloWorldModel;
}(observable_1.Observable));
exports.HelloWorldModel = HelloWorldModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi12aWV3LW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi12aWV3LW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQTJDO0FBRzNDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUUzQix1RUFBc0U7QUFJdEUsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzdCLElBQUksV0FBVyxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBWXREO0lBQTJCLGdDQUFRO0lBQW5DOztJQW9DQSxDQUFDO0lBaENVLGdCQUFHLEdBQVY7UUFDSSxNQUFNLENBQWtCLE9BQU0sR0FBRyxXQUFFLENBQUE7SUFDdkMsQ0FBQztJQUVELHVDQUFnQixHQUFoQixVQUFpQixJQUFJO1FBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNuQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFDRCxnREFBeUIsR0FBekIsVUFBMEIsSUFBSSxFQUFFLEtBQUs7UUFFakMsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdEIsQ0FBQztJQUNELDZDQUFzQixHQUF0QixVQUF1QixJQUFJLEVBQUUsS0FBSztRQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUE7UUFDckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFBQSxDQUFDO0lBQ0YsNENBQXFCLEdBQXJCLFVBQXNCLElBQUksRUFBRSxXQUFXO1FBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMs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QXFDLHVCQUFVLEdBdU05QztBQXZNWSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAnZGF0YS9vYnNlcnZhYmxlJztcbmltcG9ydCB7IFBhZ2UgfSBmcm9tICd1aS9wYWdlJztcbmltcG9ydCAqIGFzIGFwcCBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy9hcHBsaWNhdGlvblwiO1xudmFyIGh0dHAgPSByZXF1aXJlKFwiaHR0cFwiKTtcblxuaW1wb3J0IHsgTG9jYWxWaWRlbywgVmlkZW9BY3Rpdml0eSB9IGZyb20gJ25hdGl2ZXNjcmlwdC10d2lsaW8tdmlkZW8nO1xuXG5cblxudmFyIHRpbWVyID0gcmVxdWlyZShcInRpbWVyXCIpO1xudmFyIHBlcm1pc3Npb25zID0gcmVxdWlyZSgnbmF0aXZlc2NyaXB0LXBlcm1pc3Npb25zJyk7XG5cbmludGVyZmFjZSBUVklSb29tRGVsZWdhdGUgZXh0ZW5kcyBOU09iamVjdFByb3RvY29sIHtcbiAgICBkaWRDb25uZWN0VG9Sb29tPyhyb29tOiBhbnkpOiB2b2lkO1xuICAgIGRpZEZhaWxUb0Nvbm5lY3RXaXRoRXJyb3I/KHJvb206IGFueSwgZXJyb3I6IEVycm9yKTogdm9pZDtcbiAgICBkaWREaXNjb25uZWN0V2l0aEVycm9yPyhyb29tOiBhbnksIGVycm9yOiBFcnJvcik6IHZvaWQ7XG4gICAgcGFydGljaXBhbnREaWRDb25uZWN0Pyhyb29tLCBwYXJ0aWNpcGFudCk6IHZvaWQ7XG4gICAgcGFydGljaXBhbnREaWREaXNjb25uZWN0Pyhyb29tLCBwYXJ0aWNpcGFudCk6IHZvaWQ7XG4gICAgcm9vbURpZFN0YXJ0UmVjb3JkaW5nPyhyb29tKTogdm9pZDtcbiAgICByb29tRGlkU3RvcFJlY29yZGluZz8ocm9vbSk6IHZvaWQ7XG59XG5cbmNsYXNzIFJvb21EZWxlZ2F0ZSBleHRlbmRzIE5TT2JqZWN0IGltcGxlbWVudHMgVFZJUm9vbURlbGVnYXRlIHtcbiAgICBcbiAgICBzdGF0aWMgT2JqQ1Byb3RvY29scyA9IFsgVFZJUm9vbURlbGVnYXRlIF07IC8vIGRlZmluZSBvdXIgbmF0aXZlIHByb3RvY2FsbHNcblxuICAgIHN0YXRpYyBuZXcoKTogVFZJUm9vbURlbGVnYXRlIHtcbiAgICAgICAgcmV0dXJuIDxUVklSb29tRGVsZWdhdGU+c3VwZXIubmV3KCkgLy8gY2FsbHMgbmV3KCkgb24gdGhlIE5TT2JqZWN0XG4gICAgfVxuXG4gICAgZGlkQ29ubmVjdFRvUm9vbShyb29tKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjb25uZWN0ZWQgdG8gYSByb29tJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKHJvb20pO1xuICAgIH1cbiAgICBkaWRGYWlsVG9Db25uZWN0V2l0aEVycm9yKHJvb20sIGVycm9yKSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ2RpZEZhaWxUb0Nvbm5lY3RXaXRoRXJyb3InKTtcbiAgICAgICAgY29uc29sZS5sb2cocm9vbSk7XG4gICAgfVxuICAgIGRpZERpc2Nvbm5lY3RXaXRoRXJyb3Iocm9vbSwgZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2RpZERpc2Nvbm5lY3RXaXRoRXJyb3InKVxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIGNvbnNvbGUubG9nKHJvb20pO1xuICAgIH07XG4gICAgcGFydGljaXBhbnREaWRDb25uZWN0KHJvb20sIHBhcnRpY2lwYW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdwYXJ0aWNpcGFudERpZENvbm5lY3QnKTtcbiAgICAgICAgY29uc29sZS5sb2cocm9vbSk7XG4gICAgfVxuICAgIHBhcnRpY2lwYW50RGlkRGlzY29ubmVjdChyb29tLCBwYXJ0aWNpcGFudCkge1xuICAgICAgICBjb25zb2xlLmxvZygncGFydGljaXBhbnREaWREaXNjb25uZWN0Jyk7XG4gICAgICAgIGNvbnNvbGUubG9nKHJvb20pO1xuICAgIH0gICAgXG4gICAgcm9vbURpZFN0YXJ0UmVjb3JkaW5nKHJvb20pIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3Jvb21EaWRTdGFydFJlY29yZGluZycpXG4gICAgfVxuICAgIHJvb21EaWRTdG9wUmVjb3JkaW5nKHJvb20pIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3Jvb21EaWRTdG9wUmVjb3JkaW5nJylcbiAgICB9XG59ICAgXG5cblxuXG5cbmV4cG9ydCBjbGFzcyBIZWxsb1dvcmxkTW9kZWwgZXh0ZW5kcyBPYnNlcnZhYmxlIHtcbiAgICByb29tOiBhbnk7XG4gICAgdmlkZW9BY3Rpdml0eTogVmlkZW9BY3Rpdml0eTtcbiAgICAvLyBnYW1lIG1vZGUgcmVhZCBteSBsaXBzXG4gICAgXG4gICAgXG4gICAgdG9rZW46IHN0cmluZyA9ICdleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpJVXpJMU5pSXNJbU4wZVNJNkluUjNhV3hwYnkxbWNHRTdkajB4SW4wLmV5SnFkR2tpT2lKVFN6TmpNbUU1T1RJMVlqZzROVFV3T0RnMVpEaGpaREptTnpNd1lXTmxNVFptTFRFME9UYzRNekUyT0RraUxDSnBjM01pT2lKVFN6TmpNbUU1T1RJMVlqZzROVFV3T0RnMVpEaGpaREptTnpNd1lXTmxNVFptSWl3aWMzVmlJam9pUVVNNU5qRmhaak16WW1VeVpESTJPV0l6WlRNMk5UaGlOakpsTldVMVpEVTFPQ0lzSW1WNGNDSTZNVFE1Tnpnek5USTRPU3dpWjNKaGJuUnpJanA3SW1sa1pXNTBhWFI1SWpvaWR5SXNJblpwWkdWdklqcDdJbkp2YjIwaU9pSmxJbjE5ZlEuMFBqWUUyRHQzLTNWbFJpLUVFck1zbUc0NEFDcjMxM2o0NjAzTzhYNUFqVSdcbiAgICBwcml2YXRlIGxvY2FsVmlkZW86IGFueTtcbiAgICBwcml2YXRlIGFjY2Vzc1Rva2VuOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSByb29tTmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBoZXJvczogYW55O1xuICAgIHB1YmxpYyBwYXJ0aWNpcGFudDogYW55O1xuICAgIHB1YmxpYyBjb3VudGRvd246IG51bWJlciA9IDYwO1xuICAgIHB1YmxpYyByb29tQnV0dG9uOiBhbnk7XG5cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcGFnZTogUGFnZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBsZXQgZGVsZWdhdGUgPSA8Um9vbURlbGVnYXRlPlJvb21EZWxlZ2F0ZS5uZXcoKVxuXG4gICAgICAgIC8vIGxldCByb29tOiBUVklSb29tID0gVFZJUm9vbS5uZXcoKVxuICAgICAgICAvLyB0ZXNzLmRlbGVnYXRlID0gZGVsZWdhdGVcbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICAvLyBsZXQgdGVzczogRzhUZXNzZXJhY3QgPSBHOFRlc3NlcmFjdC5uZXcoKVxuICAgICAgICAvLyB0ZXNzLmRlbGVnYXRlID0gZGVsZWdhdGVcblxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coT2JqZWN0LmtleXMoVFZJUm9vbURlbGVnYXRlKSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgY29ubmVjdE9wdGlvbnMgPSBUVklDb25uZWN0T3B0aW9ucy5vcHRpb25zV2l0aEJsb2NrKCAoYnVpbGRlcikgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBidWlsZGVyLmxvY2FsTWVkaWEgPSBudWxsO1xuICAgICAgICAgICAgYnVpbGRlci5uYW1lID0gJ2NyYXp5JztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gY29uc29sZS5kaXIoY29ubmVjdE9wdGlvbnMpO1xuICAgICAgICBcblxuXG5cbiAgICAgICAgdmFyIHZpZGVvQ2xpZW50ID0gVFZJVmlkZW9DbGllbnQuY2xpZW50V2l0aFRva2VuKHRoaXMudG9rZW4pO1xuICAgICAgICB0aGlzLnJvb20gPSB2aWRlb0NsaWVudC5jb25uZWN0V2l0aE9wdGlvbnNEZWxlZ2F0ZShjb25uZWN0T3B0aW9ucywgZGVsZWdhdGUpO1xuICAgICAgICBcblxuICAgICAgICBjb25zb2xlLmRpcih0aGlzLnJvb20pXG5cblxuXG5cbiAgICAgICAgXG5cblxuXG5cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5ID0gbmV3IFZpZGVvQWN0aXZpdHkoKTtcbiAgICAgICAgLy8gdGhpcy5nZXRQZXJtaXNzaW9ucygpO1xuICAgICAgICAvLyB0aGlzLnNldCgncGFydGljaXBhbnQnLCAnd293Jyk7XG4gICAgICAgIC8vIGxldCBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyB0aGlzLnZpZGVvQWN0aXZpdHkudmlkZW9FdmVudC5vbignb25Db25uZWN0ZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAvLyAgICAgbGV0IHBhcnRpY2lwYW50cyA9IGRhdGEub2JqZWN0Wydyb29tJ10uZ2V0UGFydGljaXBhbnRzKCk7XG4gICAgICAgIC8vICAgICBsZXQgc3RyaW5nID0gZGF0YS5vYmplY3Quc3RyaW5nO1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coc3RyaW5nKTtcbiAgICAgICAgLy8gICAgIHRoaXMuc2V0KCdwYXJ0aWNpcGFudCcsIHN0cmluZyk7XG4gICAgICAgIC8vICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHBhcnRpY2lwYW50cy5zaXplKCk7IGkgPCBsOyBpKyspIHtcblxuICAgICAgICAvLyAgICAgICAgIHZhciBwYXJ0aWNpcGFudCA9IHBhcnRpY2lwYW50cy5nZXQoaSk7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5wYXJ0aWNpcGFudCA9IHBhcnRpY2lwYW50LmdldElkZW50aXR5KCk7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2codGhpcy5wYXJ0aWNpcGFudCwgJyBpcyBhICcsIHR5cGVvZiB0aGlzLnBhcnRpY2lwYW50KTtcbiAgICAgICAgLy8gICAgICAgICB0aGlzLnNldCgncGFydGljaXBhbnQnLCBTdHJpbmcocGFydGljaXBhbnQuZ2V0SWRlbnRpdHkoKSkpO1xuXG4gICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAvLyAgICAgLy8gY29uc29sZS5sb2coZGF0YS5vYmplY3RbJ3Jvb20nXS5nZXROYW1lKCkpOyAvLyByb29tIG5hbWVcbiAgICAgICAgLy8gfSkgIFxuICAgICAgICAvLyB0aGlzLnZpZGVvQWN0aXZpdHkudmlkZW9FdmVudC5vbignb25Db25uZWN0RmFpbHVyZScsIChkYXRhKSA9PiB7XG4gICAgICAgIC8vICAgICAvLyBsZWF2ZSByb29tLi4gcmVxdWVzdCBuZXcgbWF0Y2hcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdvbkNvbm5lY3RGYWlsdXJlJyk7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmRpcihkYXRhKTtcbiAgICAgICAgLy8gfSkgXG4gICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS52aWRlb0V2ZW50Lm9uKCdvbkRpc2Nvbm5lY3RlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIC8vICAgICAvLyBsZWF2ZSByb29tLi4gcmVxdWVzdCBuZXcgbWF0Y2hcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdvbkRpc2Nvbm5lY3RlZCcpO1xuICAgICAgICAgICAgXG4gICAgICAgIC8vICAgICB0aGlzLnBhcnRpY2lwYW50ID0gZGF0YS5vYmplY3RbJ3BhcnRpY2lwYW50J10uZ2V0SWRlbnRpdHkoKTtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdvbkRpc2Nvbm5lY3RlZDogJywgdGhpcy5wYXJ0aWNpcGFudCk7XG4gICAgICAgIC8vIH0pIFxuICAgICAgICAvLyB0aGlzLnZpZGVvQWN0aXZpdHkudmlkZW9FdmVudC5vbignb25QYXJ0aWNpcGFudENvbm5lY3RlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnb25QYXJ0aWNpcGFudENvbm5lY3RlZCcpO1xuICAgICAgICAvLyAgICAgdGhpcy5wYXJ0aWNpcGFudCA9IGRhdGEub2JqZWN0WydwYXJ0aWNpcGFudCddLmdldElkZW50aXR5KCk7XG4gICAgICAgIC8vICAgICB0aGlzLnNldCgncGFydGljaXBhbnQnLCBkYXRhLm9iamVjdFsncGFydGljaXBhbnQnXS5nZXRJZGVudGl0eSgpKTtcbiAgICAgICAgLy8gfSkgXG4gICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS52aWRlb0V2ZW50Lm9uKCdvblBhcnRpY2lwYW50RGlzY29ubmVjdGVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgLy8gICAgIC8vIGxlYXZlIHJvb20uLiByZXF1ZXN0IG5ldyBtYXRjaFxuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ29uUGFydGljaXBhbnREaXNjb25uZWN0ZWQnKTtcbiAgICAgICAgLy8gICAgIHRoaXMucGFydGljaXBhbnQgPSBkYXRhLm9iamVjdFsncGFydGljaXBhbnQnXS5nZXRJZGVudGl0eSgpO1xuICAgICAgICAvLyB9KSBcbiAgICAgICAgLy8gdGhpcy52aWRlb0FjdGl2aXR5LnZpZGVvRXZlbnQub24oJ29uQXVkaW9UcmFja0FkZGVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdvbkF1ZGlvVHJhY2tBZGRlZCcpO1xuICAgICAgICAvLyB9KSBcbiAgICAgICAgLy8gdGhpcy52aWRlb0FjdGl2aXR5LnZpZGVvRXZlbnQub24oJ29uQXVkaW9UcmFja1JlbW92ZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ29uQXVkaW9UcmFja1JlbW92ZWQnKTtcbiAgICAgICAgLy8gfSkgXG4gICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS52aWRlb0V2ZW50Lm9uKCdvblZpZGVvVHJhY2tBZGRlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnb25WaWRlb1RyYWNrQWRkZWQnKTtcbiAgICAgICAgLy8gfSkgXG4gICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS52aWRlb0V2ZW50Lm9uKCdvblZpZGVvVHJhY2tSZW1vdmVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdvblZpZGVvVHJhY2tSZW1vdmVkJyk7XG4gICAgICAgIC8vIH0pICBcbiAgICAgICAgLy8gdGhpcy52aWRlb0FjdGl2aXR5LnZpZGVvRXZlbnQub24oJ29uQXVkaW9UcmFja0VuYWJsZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ29uQXVkaW9UcmFja0VuYWJsZWQnKTtcbiAgICAgICAgLy8gfSkgIFxuICAgICAgICAvLyB0aGlzLnZpZGVvQWN0aXZpdHkudmlkZW9FdmVudC5vbignb25BdWRpb1RyYWNrRGlzYWJsZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ29uQXVkaW9UcmFja0Rpc2FibGVkJyk7XG4gICAgICAgIC8vIH0pIFxuICAgICAgICAvLyB0aGlzLnZpZGVvQWN0aXZpdHkudmlkZW9FdmVudC5vbignb25WaWRlb1RyYWNrRW5hYmxlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnb25WaWRlb1RyYWNrRW5hYmxlZCcpO1xuICAgICAgICAvLyB9KSAgXG4gICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS52aWRlb0V2ZW50Lm9uKCdvblZpZGVvVHJhY2tEaXNhYmxlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnb25WaWRlb1RyYWNrRGlzYWJsZWQnKTtcbiAgICAgICAgLy8gfSkgICAgICAgICAgXG4gICAgICAgIFxuICAgIH1cblxuXG5cbiAgICBnZXRQZXJtaXNzaW9ucygpOiB2b2lkIHtcblxuICAgICAgICBwZXJtaXNzaW9ucy5yZXF1ZXN0UGVybWlzc2lvbnMoW1xuICAgICAgICAgICAgYW5kcm9pZC5NYW5pZmVzdC5wZXJtaXNzaW9uLlJFQ09SRF9BVURJTyxcbiAgICAgICAgICAgIGFuZHJvaWQuTWFuaWZlc3QucGVybWlzc2lvbi5DQU1FUkFcbiAgICAgICAgICAgIF0sIFwiSSBuZWVkIHRoZXNlIHBlcm1pc3Npb25zIGJlY2F1c2UgSSdtIGNvb2xcIilcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZGlyKGUpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVWggb2gsIG5vIHBlcm1pc3Npb25zIC0gcGxhbiBCIHRpbWUhXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gXG4gICAgcHVibGljIGRpc2Nvbm5lY3QoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjbGlja2VkJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMucm9vbSk7XG4gICAgICAgIHRoaXMucm9vbS5kaXNjb25uZWN0KCk7XG4gICAgfVxuXG5cblxuICAgIHB1YmxpYyBhZGRfdGltZSgpIHtcbiAgICAgICAgY29uc29sZS5kaXIodGhpcy5yb29tKVxuICAgIH1cblxuXG4gICAgcHVibGljIHNob3dfbG9jYWxfdmlkZW8oKSB7XG4gICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS5jcmVhdGVBdWRpb0FuZFZpZGVvVHJhY2tzKCk7XG5cbiAgICB9XG5cbiAgICAvLyBwdWJsaWMgdG9nZ2xlX2xvY2FsX3ZpZGVvKCkge1xuXG4gICAgLy8gICAgIHRoaXMudmlkZW9BY3Rpdml0eS50b2dnbGVfbG9jYWxfdmlkZW8oKTtcblxuICAgIC8vIH1cblxuICAgIHB1YmxpYyBzZXRfYWNjZXNzX3Rva2VuKHRva2VuOiBzdHJpbmcsIG5hbWU6IHN0cmluZykge1xuXG4gICAgICAgIFxuXG4gICAgfVxuXG5cblxuICAgIHB1YmxpYyBjb25uZWN0X3RvX3Jvb20ocm9vbTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnNvbGUuZGlyKHRoaXMucm9vbSlcbiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy52aWRlb0FjdGl2aXR5KTtcbiAgICAgICAgLy8gdGhpcy52aWRlb0FjdGl2aXR5LnNldF9hY2Nlc3NfdG9rZW4oJ3dvdycsICd3b3cnKTtcbiAgICAgICAgLy8gdGhpcy52aWRlb0FjdGl2aXR5LmNvbm5lY3RfdG9fcm9vbSgnYWFkZnNkJyk7ICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8vIGh0dHAuZ2V0SlNPTignaHR0cDovL2FjODY1ZmYyLm5ncm9rLmlvL3Rva2VuJykudGhlbigocmVzKSA9PiB7XG4gICAgICAgIC8vICAgICB0aGlzLnNldCgnbmFtZScsIHJlcy5pZGVudGl0eSk7XG4gICAgICAgIC8vICAgICB0aGlzLnNldF9hY2Nlc3NfdG9rZW4ocmVzLnRva2VuLCByZXMuaWRlbnRpdHkpO1xuICAgICAgICAvLyAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmNvbm5lY3RfdG9fcm9vbSgnYWFzc2JjZGFlZmdoYWlqc3NrbG0nKTtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdoaXQnKTsgICAgICAgICAgXG4gICAgICAgIC8vIH0sIChlKSA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgLy8gfSk7XG4gICAgICAgIFxuICAgIH1cblxuXG59Il19