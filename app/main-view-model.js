"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var app = require("tns-core-modules/application");
var http = require("http");
var nativescript_twilio_video_1 = require("nativescript-twilio-video");
var timer = require("timer");
var permissions = require('nativescript-permissions');
var participant;
var _pdelegate;
var rdelegate;
var HelloWorldModel = (function (_super) {
    __extends(HelloWorldModel, _super);
    function HelloWorldModel(page) {
        var _this = _super.call(this) || this;
        _this.page = page;
        _this.countdown = 60;
        var localVideo = _this.page.getViewById('local-video');
        var remoteVideo = _this.page.getViewById('remote-video');
        _this.videoActivity = new nativescript_twilio_video_1.VideoActivity();
        _this.videoActivity.localVideoView = localVideo.localVideoView;
        _this.videoActivity.remoteVideoView = remoteVideo.remoteVideoView;
        _this.getPermissions();
        _this.videoActivity.events.on('onConnected', function (data) {
            var room = data.object['room'];
            console.log(room);
            _this.videoActivity.set_listener_for_participants(room);
        });
        _this.videoActivity.events.on('onParticipantConnected', function (data) {
            console.log('onParticipantConnected');
            var participant = data.object['participant'];
            var room = data.object['room'];
            _this.videoActivity.participant_joined_room(participant);
        });
        _this.videoActivity.events.on('onVideoTrackAdded', function (data) {
            console.log('onVideoTrackAdded');
            var videoTrack = data.object['videoTrack'];
            var participant = data.object['participant'];
            _this.videoActivity.add_video_track(videoTrack);
        });
        _this.videoActivity.events.on('onDisconnected', function (data) {
            _this.videoActivity.configure_audio(false);
            console.log('onDisconnected');
        });
        _this.videoActivity.events.on('onConnectFailure', function (data) {
            console.log('onConnectFailure');
            _this.videoActivity.configure_audio(false);
        });
        _this.videoActivity.events.on('onParticipantDisconnected', function (data) {
            console.log('onParticipantDisconnected');
            var participant = data.object['participant'];
            _this.videoActivity.removeParticipant(participant);
        });
        _this.videoActivity.events.on('onAudioTrackAdded', function (data) {
            console.log('onAudioTrackAdded');
        });
        _this.videoActivity.events.on('onAudioTrackRemoved', function (data) {
            console.log('onAudioTrackRemoved');
        });
        _this.videoActivity.events.on('onVideoTrackRemoved', function (data) {
            console.log('onVideoTrackRemoved');
        });
        _this.videoActivity.events.on('onAudioTrackEnabled', function (data) {
            console.log('onAudioTrackEnabled');
        });
        _this.videoActivity.events.on('onAudioTrackDisabled', function (data) {
            console.log('onAudioTrackDisabled');
        });
        _this.videoActivity.events.on('onVideoTrackEnabled', function (data) {
            console.log('onVideoTrackEnabled');
        });
        _this.videoActivity.events.on('onVideoTrackDisabled', function (data) {
            console.log('onVideoTrackDisabled');
        });
        return _this;
    }
    HelloWorldModel.prototype.getPermissions = function () {
        if (app.android) {
            permissions.requestPermissions([
                android.Manifest.permission.RECORD_AUDIO,
                android.Manifest.permission.CAMERA
            ], "I need these permissions because I'm cool")
                .then(function (response) {
            })
                .catch(function (e) {
                console.dir(e);
                console.log("Uh oh, no permissions - plan B time!");
            });
        }
    };
    HelloWorldModel.prototype.disconnect = function () {
        this.videoActivity.roomObj.disconnect();
    };
    HelloWorldModel.prototype.add_time = function () {
    };
    HelloWorldModel.prototype.show_local_video = function () {
        this.videoActivity.createAudioAndVideoTracks();
    };
    HelloWorldModel.prototype.toggle_local_audio = function () {
        this.videoActivity.toggle_local_audio();
    };
    HelloWorldModel.prototype.toggle_local_video = function () {
        this.videoActivity.toggle_local_video();
    };
    HelloWorldModel.prototype.connect_to_room = function (room) {
        var _this = this;
        http.getJSON('https://88648a24.ngrok.io/token').then(function (res) {
            _this.videoActivity.set_access_token(res.token);
            _this.videoActivity.connect_to_room('0123a1');
        }, function (e) {
            console.log(e);
        });
    };
    return HelloWorldModel;
}(observable_1.Observable));
exports.HelloWorldModel = HelloWorldModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi12aWV3LW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi12aWV3LW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQXlEO0FBRXpELGtEQUFvRDtBQUVwRCxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFM0IsdUVBQWtGO0FBS2xGLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM3QixJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN0RCxJQUFJLFdBQVcsQ0FBQztBQUNoQixJQUFJLFVBQVUsQ0FBQztBQUNmLElBQUksU0FBUyxDQUFDO0FBV2Q7SUFBcUMsbUNBQVU7SUFlM0MseUJBQW9CLElBQVU7UUFBOUIsWUFDSSxpQkFBTyxTQWdJVjtRQWpJbUIsVUFBSSxHQUFKLElBQUksQ0FBTTtRQUx2QixlQUFTLEdBQVcsRUFBRSxDQUFDO1FBUTFCLElBQUksVUFBVSxHQUFlLEtBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRWxFLElBQUksV0FBVyxHQUFnQixLQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUVyRSxLQUFJLENBQUMsYUFBYSxHQUFHLElBQUkseUNBQWEsRUFBRSxDQUFDO1FBRXpDLEtBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUM7UUFFOUQsS0FBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEdBQUcsV0FBVyxDQUFDLGVBQWUsQ0FBQztRQUVqRSxLQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFdEIsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxVQUFDLElBQUk7WUFFN0MsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUUvQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxCLEtBQUksQ0FBQyxhQUFhLENBQUMsNkJBQTZCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFM0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsd0JBQXdCLEVBQUUsVUFBQyxJQUFJO1lBRXhELE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUV0QyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTdDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFL0IsS0FBSSxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQU01RCxDQUFDLENBQUMsQ0FBQztRQUVILEtBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxVQUFDLElBQUk7WUFNbkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBRWpDLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFM0MsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUU3QyxLQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUduRCxDQUFDLENBQUMsQ0FBQztRQUVILEtBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFDLElBQUk7WUFNaEQsS0FBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRWxDLENBQUMsQ0FBQyxDQUFDO1FBSUgsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLGtCQUFrQixFQUFFLFVBQUMsSUFBSTtZQUVsRCxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFFaEMsS0FBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUMsQ0FBQyxDQUFDLENBQUM7UUFHSCxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsMkJBQTJCLEVBQUUsVUFBQyxJQUFJO1lBRTNELE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztZQU16QyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTdDLEtBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFJdEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsbUJBQW1CLEVBQUUsVUFBQyxJQUFJO1lBRW5ELE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUVyQyxDQUFDLENBQUMsQ0FBQztRQUVILEtBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxVQUFDLElBQUk7WUFFckQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBRXZDLENBQUMsQ0FBQyxDQUFDO1FBRUgsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLHFCQUFxQixFQUFFLFVBQUMsSUFBSTtZQUNyRCxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMscUJBQXFCLEVBQUUsVUFBQyxJQUFJO1lBQ3JELE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUVILEtBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxVQUFDLElBQUk7WUFDdEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLHFCQUFxQixFQUFFLFVBQUMsSUFBSTtZQUNyRCxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsc0JBQXNCLEVBQUUsVUFBQyxJQUFJO1lBQ3RELE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQzs7SUFFUCxDQUFDO0lBSUQsd0NBQWMsR0FBZDtRQUVJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBRWQsV0FBVyxDQUFDLGtCQUFrQixDQUFDO2dCQUMzQixPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxZQUFZO2dCQUN4QyxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxNQUFNO2FBQ3JDLEVBQUUsMkNBQTJDLENBQUM7aUJBQzFDLElBQUksQ0FBQyxVQUFDLFFBQVE7WUFDZixDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLFVBQUMsQ0FBQztnQkFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0NBQXNDLENBQUMsQ0FBQztZQUN4RCxDQUFDLENBQUMsQ0FBQztRQUVYLENBQUM7SUFHTCxDQUFDO0lBR00sb0NBQVUsR0FBakI7UUFFSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUU1QyxDQUFDO0lBSU0sa0NBQVEsR0FBZjtJQUVBLENBQUM7SUFHTSwwQ0FBZ0IsR0FBdkI7UUFFSSxJQUFJLENBQUMsYUFBYSxDQUFDLHlCQUF5QixFQUFFLENBQUM7SUFFbkQsQ0FBQztJQUVNLDRDQUFrQixHQUF6QjtRQUVJLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUU1QyxDQUFDO0lBR00sNENBQWtCLEdBQXpCO1FBRUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBRTVDLENBQUM7SUFFTSx5Q0FBZSxHQUF0QixVQUF1QixJQUFZO1FBQW5DLGlCQWNDO1FBWkcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUc7WUFFckQsS0FBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFL0MsS0FBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFakQsQ0FBQyxFQUFFLFVBQUMsQ0FBQztZQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbkIsQ0FBQyxDQUFDLENBQUM7SUFFUCxDQUFDO0lBRUwsc0JBQUM7QUFBRCxDQUFDLEFBek5ELENBQXFDLHVCQUFVLEdBeU45QztBQXpOWSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIGZyb21PYmplY3QgfSBmcm9tICdkYXRhL29ic2VydmFibGUnO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ3VpL3BhZ2UnO1xuaW1wb3J0ICogYXMgYXBwIGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL2FwcGxpY2F0aW9uXCI7XG5pbXBvcnQgeyBWaWV3IH0gZnJvbSBcInVpL2NvcmUvdmlld1wiXG52YXIgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xuXG5pbXBvcnQgeyBMb2NhbFZpZGVvLCBWaWRlb0FjdGl2aXR5LCBSZW1vdGVWaWRlb30gZnJvbSAnbmF0aXZlc2NyaXB0LXR3aWxpby12aWRlbyc7XG5cblxuXG5cbnZhciB0aW1lciA9IHJlcXVpcmUoXCJ0aW1lclwiKTtcbnZhciBwZXJtaXNzaW9ucyA9IHJlcXVpcmUoJ25hdGl2ZXNjcmlwdC1wZXJtaXNzaW9ucycpO1xudmFyIHBhcnRpY2lwYW50O1xudmFyIF9wZGVsZWdhdGU7XG52YXIgcmRlbGVnYXRlO1xuLyoqXG4gKiBjcmVhdGUgZGlzY29ubmVjdCBidXR0b24gdGVzdFxuICogY3JlYXRlIHRvZ2dsZSBhdWRpby92aWRlbyB0ZXN0XG4gKiBmaXggVmlkZW9BY3Rpdml0eUJhc2VcbiAqIFxuICovXG5cblxuXG5cbmV4cG9ydCBjbGFzcyBIZWxsb1dvcmxkTW9kZWwgZXh0ZW5kcyBPYnNlcnZhYmxlIHtcbiAgICByb29tOiBhbnk7XG4gICAgdmlkZW9BY3Rpdml0eTogVmlkZW9BY3Rpdml0eTtcbiAgICAvLyBnYW1lIG1vZGUgcmVhZCBteSBsaXBzXG4gICAgcHJpdmF0ZSBsb2NhbFZpZGVvOiBhbnk7XG4gICAgcHJpdmF0ZSBhY2Nlc3NUb2tlbjogc3RyaW5nO1xuICAgIHByaXZhdGUgcm9vbU5hbWU6IHN0cmluZztcbiAgICBwdWJsaWMgbmFtZTogc3RyaW5nO1xuICAgIHByaXZhdGUgaGVyb3M6IGFueTtcbiAgICBwdWJsaWMgcGFydGljaXBhbnQ6IGFueTtcbiAgICBwdWJsaWMgY291bnRkb3duOiBudW1iZXIgPSA2MDtcbiAgICBwdWJsaWMgcm9vbUJ1dHRvbjogYW55O1xuICAgIGxvY2FsVmlkZW9WaWV3OiBhbnk7XG5cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcGFnZTogUGFnZSkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIGxldCBsb2NhbFZpZGVvID0gPExvY2FsVmlkZW8+dGhpcy5wYWdlLmdldFZpZXdCeUlkKCdsb2NhbC12aWRlbycpO1xuXG4gICAgICAgIGxldCByZW1vdGVWaWRlbyA9IDxSZW1vdGVWaWRlbz50aGlzLnBhZ2UuZ2V0Vmlld0J5SWQoJ3JlbW90ZS12aWRlbycpO1xuXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eSA9IG5ldyBWaWRlb0FjdGl2aXR5KCk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkubG9jYWxWaWRlb1ZpZXcgPSBsb2NhbFZpZGVvLmxvY2FsVmlkZW9WaWV3O1xuICAgICAgICBcbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LnJlbW90ZVZpZGVvVmlldyA9IHJlbW90ZVZpZGVvLnJlbW90ZVZpZGVvVmlldztcblxuICAgICAgICB0aGlzLmdldFBlcm1pc3Npb25zKCk7XG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25Db25uZWN0ZWQnLCAoZGF0YSkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgcm9vbSA9IGRhdGEub2JqZWN0Wydyb29tJ107XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJvb20pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuc2V0X2xpc3RlbmVyX2Zvcl9wYXJ0aWNpcGFudHMocm9vbSk7XG5cbiAgICAgICAgfSk7ICBcblxuICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuZXZlbnRzLm9uKCdvblBhcnRpY2lwYW50Q29ubmVjdGVkJywgKGRhdGEpID0+IHtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ29uUGFydGljaXBhbnRDb25uZWN0ZWQnKTtcblxuICAgICAgICAgICAgbGV0IHBhcnRpY2lwYW50ID0gZGF0YS5vYmplY3RbJ3BhcnRpY2lwYW50J107XG5cbiAgICAgICAgICAgIGxldCByb29tID0gZGF0YS5vYmplY3RbJ3Jvb20nXTtcblxuICAgICAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LnBhcnRpY2lwYW50X2pvaW5lZF9yb29tKHBhcnRpY2lwYW50KTtcblxuICAgICAgICAgICAgLy8gdGhpcy5wYXJ0aWNpcGFudCA9IGRhdGEub2JqZWN0WydwYXJ0aWNpcGFudCddLmdldElkZW50aXR5KCk7XG5cbiAgICAgICAgICAgIC8vIHRoaXMuc2V0KCdwYXJ0aWNpcGFudCcsIGRhdGEub2JqZWN0WydwYXJ0aWNpcGFudCddLmdldElkZW50aXR5KCkpO1xuXG4gICAgICAgIH0pOyAgIFxuXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS5ldmVudHMub24oJ29uVmlkZW9UcmFja0FkZGVkJywgKGRhdGEpID0+IHtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiAgYWRkIHZpZGVvIHRyYWNrIGhlcmVcbiAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnb25WaWRlb1RyYWNrQWRkZWQnKTtcblxuICAgICAgICAgICAgbGV0IHZpZGVvVHJhY2sgPSBkYXRhLm9iamVjdFsndmlkZW9UcmFjayddO1xuXG4gICAgICAgICAgICBsZXQgcGFydGljaXBhbnQgPSBkYXRhLm9iamVjdFsncGFydGljaXBhbnQnXTtcblxuICAgICAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmFkZF92aWRlb190cmFjayh2aWRlb1RyYWNrKTtcblxuXG4gICAgICAgIH0pOyAgICAgICAgICAgICAgXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25EaXNjb25uZWN0ZWQnLCAoZGF0YSkgPT4ge1xuXG4gICAgICAgICAgICAvLyBsZXQgdmlkZW9UcmFjayA9IGRhdGEub2JqZWN0Wyd2aWRlb1RyYWNrJ107XG5cbiAgICAgICAgICAgIC8vIHRoaXMudmlkZW9BY3Rpdml0eS5yZW1vdmVQYXJ0aWNpcGFudFZpZGVvKHZpZGVvVHJhY2spOyAgIFxuXG4gICAgICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuY29uZmlndXJlX2F1ZGlvKGZhbHNlKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ29uRGlzY29ubmVjdGVkJyk7XG5cbiAgICAgICAgfSk7IFxuXG4gXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25Db25uZWN0RmFpbHVyZScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAvLyBsZWF2ZSByb29tLi4gcmVxdWVzdCBuZXcgbWF0Y2hcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbkNvbm5lY3RGYWlsdXJlJyk7XG5cbiAgICAgICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS5jb25maWd1cmVfYXVkaW8oZmFsc2UpO1xuXG4gICAgICAgIH0pO1xuXG4gXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS5ldmVudHMub24oJ29uUGFydGljaXBhbnREaXNjb25uZWN0ZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnb25QYXJ0aWNpcGFudERpc2Nvbm5lY3RlZCcpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIGxlYXZlIHJvb20uLiByZXF1ZXN0IG5ldyBtYXRjaFxuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIGxldCBwYXJ0aWNpcGFudCA9IGRhdGEub2JqZWN0WydwYXJ0aWNpcGFudCddO1xuXG4gICAgICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkucmVtb3ZlUGFydGljaXBhbnQocGFydGljaXBhbnQpOyAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAvLyB0aGlzLnBhcnRpY2lwYW50ID0gZGF0YS5vYmplY3RbJ3BhcnRpY2lwYW50J10uZ2V0SWRlbnRpdHkoKTtcblxuICAgICAgICB9KTsgXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25BdWRpb1RyYWNrQWRkZWQnLCAoZGF0YSkgPT4ge1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnb25BdWRpb1RyYWNrQWRkZWQnKTtcblxuICAgICAgICB9KTsgXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25BdWRpb1RyYWNrUmVtb3ZlZCcsIChkYXRhKSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbkF1ZGlvVHJhY2tSZW1vdmVkJyk7XG5cbiAgICAgICAgfSk7IFxuXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS5ldmVudHMub24oJ29uVmlkZW9UcmFja1JlbW92ZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVmlkZW9UcmFja1JlbW92ZWQnKTtcbiAgICAgICAgfSk7ICBcblxuICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuZXZlbnRzLm9uKCdvbkF1ZGlvVHJhY2tFbmFibGVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbkF1ZGlvVHJhY2tFbmFibGVkJyk7XG4gICAgICAgIH0pOyAgXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25BdWRpb1RyYWNrRGlzYWJsZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ29uQXVkaW9UcmFja0Rpc2FibGVkJyk7XG4gICAgICAgIH0pOyBcblxuICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuZXZlbnRzLm9uKCdvblZpZGVvVHJhY2tFbmFibGVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvblZpZGVvVHJhY2tFbmFibGVkJyk7XG4gICAgICAgIH0pOyAgXG5cbiAgICAgICAgdGhpcy52aWRlb0FjdGl2aXR5LmV2ZW50cy5vbignb25WaWRlb1RyYWNrRGlzYWJsZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ29uVmlkZW9UcmFja0Rpc2FibGVkJyk7XG4gICAgICAgIH0pOyAgICAgICAgICBcblxuICAgIH1cblxuXG5cbiAgICBnZXRQZXJtaXNzaW9ucygpOiB2b2lkIHtcblxuICAgICAgICBpZiAoYXBwLmFuZHJvaWQpIHtcblxuICAgICAgICAgICAgcGVybWlzc2lvbnMucmVxdWVzdFBlcm1pc3Npb25zKFtcbiAgICAgICAgICAgICAgICBhbmRyb2lkLk1hbmlmZXN0LnBlcm1pc3Npb24uUkVDT1JEX0FVRElPLFxuICAgICAgICAgICAgICAgIGFuZHJvaWQuTWFuaWZlc3QucGVybWlzc2lvbi5DQU1FUkFcbiAgICAgICAgICAgIF0sIFwiSSBuZWVkIHRoZXNlIHBlcm1pc3Npb25zIGJlY2F1c2UgSSdtIGNvb2xcIilcbiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmRpcihlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVaCBvaCwgbm8gcGVybWlzc2lvbnMgLSBwbGFuIEIgdGltZSFcIik7XG4gICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgXG5cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cblxuICAgIHB1YmxpYyBkaXNjb25uZWN0KCkge1xuXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS5yb29tT2JqLmRpc2Nvbm5lY3QoKTtcblxuICAgIH1cblxuXG5cbiAgICBwdWJsaWMgYWRkX3RpbWUoKSB7XG4gICAgICAgIC8vIGNvbnNvbGUuZGlyKFRWSUNhbWVyYUNhcHR1cmVyLmFsbG9jKCkuaW5pdCgpLmluaXRXaXRoRnJhbWVEZWxlZ2F0ZSgpKTtcbiAgICB9XG5cblxuICAgIHB1YmxpYyBzaG93X2xvY2FsX3ZpZGVvKCkge1xuXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS5jcmVhdGVBdWRpb0FuZFZpZGVvVHJhY2tzKCk7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgdG9nZ2xlX2xvY2FsX2F1ZGlvKCkge1xuXG4gICAgICAgIHRoaXMudmlkZW9BY3Rpdml0eS50b2dnbGVfbG9jYWxfYXVkaW8oKTtcblxuICAgIH1cblxuXG4gICAgcHVibGljIHRvZ2dsZV9sb2NhbF92aWRlbygpIHtcblxuICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkudG9nZ2xlX2xvY2FsX3ZpZGVvKCk7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgY29ubmVjdF90b19yb29tKHJvb206IHN0cmluZyk6IHZvaWQgeyAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGh0dHAuZ2V0SlNPTignaHR0cHM6Ly84ODY0OGEyNC5uZ3Jvay5pby90b2tlbicpLnRoZW4oKHJlcykgPT4ge1xuXG4gICAgICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuc2V0X2FjY2Vzc190b2tlbihyZXMudG9rZW4pO1xuXG4gICAgICAgICAgICB0aGlzLnZpZGVvQWN0aXZpdHkuY29ubmVjdF90b19yb29tKCcwMTIzYTEnKTtcblxuICAgICAgICB9LCAoZSkgPT4ge1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcblxuICAgICAgICB9KTtcblxuICAgIH1cblxufSJdfQ==